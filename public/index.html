<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <meta
      name="description"
      content="元旦（Asia/Tokyoの1/1）だけ本編を表示する年賀状ページです。"
    />
    <title>新年のご挨拶</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="page">
      <header class="hero">
        <div class="badge">迎春</div>
        <h1>あけましておめでとうございます</h1>
        <p class="lead">
          <span id="main-year">2025</span>年もよろしくお願いいたします。
        </p>
      </header>

      <main class="content">
        <section id="main" class="panel" hidden>
          <h2>本編</h2>
          <p class="lead-sub">
            元旦だけ公開されるムービーです。お好きな方法で埋め込めます。
          </p>

          <div class="video-grid">
            <div class="video-card">
              <div class="video-embed">
                <iframe
                  src="https://www.youtube.com/embed/VIDEO_ID"
                  title="YouTube 埋め込み動画"
                  loading="lazy"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen
                  referrerpolicy="strict-origin-when-cross-origin"
                ></iframe>
              </div>
              <p class="caption">
                YouTube 埋め込み用。<span class="mono">VIDEO_ID</span> を差し替えてください。
              </p>
            </div>

            <div class="video-card">
              <video controls playsinline preload="metadata">
                <source src="videos/newyear.mp4" type="video/mp4" />
                お使いのブラウザは video タグに対応していません。
              </video>
              <p class="caption">
                <span class="mono">public/videos/newyear.mp4</span> を配置すると再生できます。
              </p>
            </div>
          </div>
        </section>

        <section id="waiting" class="panel">
          <h2 id="waiting-title">準備中</h2>
          <p id="waiting-message">
            元旦（JST）だけ本編を表示します。公開までお待ちください。
          </p>
          <p id="waiting-date" class="meta">JST: --</p>
          <noscript>
            <p class="noscript">
              JavaScript が無効のため日付判定ができません。元旦以外は準備中表示です。
            </p>
          </noscript>
        </section>
      </main>

      <footer class="footer">
        <span>Happy New Year</span>
        <span class="divider">•</span>
        <span id="footer-year">2025</span>
      </footer>
    </div>

    <script>
      (() => {
        const main = document.getElementById("main");
        const waiting = document.getElementById("waiting");
        const waitingTitle = document.getElementById("waiting-title");
        const waitingMessage = document.getElementById("waiting-message");
        const waitingDate = document.getElementById("waiting-date");
        const mainYear = document.getElementById("main-year");
        const footerYear = document.getElementById("footer-year");

        if (!main || !waiting || !waitingTitle || !waitingMessage || !waitingDate) {
          return;
        }

        const now = new Date();
        const parts = new Intl.DateTimeFormat("ja-JP", {
          timeZone: "Asia/Tokyo",
          year: "numeric",
          month: "numeric",
          day: "numeric",
        }).formatToParts(now);

        const getPart = (type) => {
          const found = parts.find((part) => part.type === type);
          return found ? Number(found.value) : NaN;
        };

        const year = getPart("year");
        const month = getPart("month");
        const day = getPart("day");

        if (!Number.isNaN(year)) {
          if (mainYear) {
            mainYear.textContent = String(year);
          }
          if (footerYear) {
            footerYear.textContent = String(year);
          }
        }

        const isJanFirst = month === 1 && day === 1;

        if (isJanFirst) {
          main.hidden = false;
          waiting.hidden = true;
        } else {
          main.hidden = true;
          waiting.hidden = false;
        }

        const status = month === 12 ? "準備中" : "終了";
        waitingTitle.textContent = status;

        if (status === "準備中") {
          waitingMessage.textContent = `${year + 1}年1月1日（JST）に公開されます。`;
        } else {
          waitingMessage.textContent =
            "本編の公開は終了しました。来年の元旦にまたお越しください。";
        }

        waitingDate.textContent = `JST: ${year}年${month}月${day}日`;
      })();
    </script>
  </body>
</html>
